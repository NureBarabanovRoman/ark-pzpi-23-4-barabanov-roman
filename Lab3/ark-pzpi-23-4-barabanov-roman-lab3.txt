МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ





ЗВІТ
До лабораторної роботи №3
З дисципліни «Аналіз та рефакторинг коду»














Виконав:
ст. гр. ПЗПІ-23-4
Барабанов Р.П.

Перевірив:
Ст. викладач кафедри ПІ
Сокорчук Ігор Петрович












Харків – 2025
2 ЗАВДАННЯ
     Ознайомитися з процесом розробки бізнес-логіки та функцій адміністрування серверної частини програмної системи. Отримати практичні навички реалізації математичних алгоритмів обробки даних, управління користувачами (RBAC), створення резервних копій (Backup) та локалізації системи.
Завдання:
1. Розробити математичну бізнес-логіку для аналізу результатів опитувань.
2. Реалізувати функції адміністрування: перегляд логів, резервне копіювання БД.
3. Впровадити систему локалізації (i18n) та конвертації часових зон.
4. Створити UML-діаграми діяльності та взаємодії.
















3 ОПИС ВИКОНАНОЇ РОБОТИ
     У ході виконання роботи функціонал серверної частини було розширено модулями бізнес-логіки та адміністрування.
3.1 Інженерні рішення бізнес-логіки
Бізнес-логіка системи базується на обробці статистичних даних в реальному часі. Для підвищення інформативності результатів голосування реалізовано наступні алгоритми:
* Розрахунок Ентропії Шеннона: Використовується як метрика "узгодженості" думок аудиторії. Висока ентропія (>1.0) сигналізує про суперечливість результатів (відсутність консенсусу).
* Статистична похибка (Margin of Error): Для кожного варіанту відповіді розраховується гранична похибка вибірки з довірчим інтервалом 95% (коефіцієнт 1.96).
* Локалізація (Localization): Реалізовано middleware для підтримки багатомовності. Система аналізує заголовок Accept-Language і повертає повідомлення про помилки українською або англійською мовами. Часові мітки конвертуються з UTC у локальний час (Europe/Kyiv).
3.2 Функції адміністрування
Для забезпечення надійності та керованості системи розроблено адміністративну панель з наступними функціями:
* RBAC (Role-Based Access Control): Розмежування прав доступу на рівні ендпоінтів. Користувачі з роллю user мають доступ лише до власних опитувань, тоді як admin має доступ до управління всіма користувачами.
* Резервне копіювання (Backup): Реалізовано функцію експорту повного стану бази даних (користувачі, опитування, голоси) у формат JSON. Це дозволяє виконувати резервне копіювання та міграцію даних без зупинки сервера.
* Журнал аудиту (System Logs): Усі критичні дії (вхід в систему, зміна ролей, завантаження бекапу) фіксуються в таблиці system_logs.
На UML діаграмі діяльності (Activity Diagram) зображено алгоритм обробки запиту на отримання аналітики, включаючи математичні розрахунки та локалізацію (див. рис. 1).

Рисунок 1 – UML діаграма діяльності
На UML діаграмі взаємодії (Sequence Diagram) зображено процес створення резервної копії бази даних адміністратором (див. рис. 2).

Рисунок 2 – UML діаграма взаємодії
Нижче наведено фрагмент коду, що реалізує математичну бізнес-логіку (розрахунок ентропії та похибки):
1.  def calculate_stats(options_db):
2.      total = sum(o.vote_count for o in options_db)
3.      entropy = 0.0
4.      
5.      # Розрахунок ентропії Шеннона
6.      if total > 0:
7.          for o in options_db:
8.              p = o.vote_count / total
9.              if p > 0: entropy -= p * math.log2(p)
10.              
11.     stats_opts = []
12.     for o in options_db:
13.         p = 0.0 if total == 0 else o.vote_count / total
14.         # Розрахунок похибки (Margin of Error, 95% confidence)
15.         err = 1.96 * math.sqrt((p*(1-p))/total) if total > 1 else 0.0
16.         stats_opts.append({
17.             "id": o.id, 
18.             "percentage": round(p*100, 1), 
19.             "margin_of_error": round(err*100, 1)
20.         })
21.         
22.     return {"entropy": round(entropy, 2), "options": stats_opts}
Нижче наведено фрагмент коду функцій адміністрування (створення бекапу):
1.  @app.get("/admin/backup", tags=["Admin"])
2.  async def create_backup(admin: User = Depends(get_current_admin), db: AsyncSession = Depends(get_db)):
3.      """Експорт бази даних у JSON"""
4.      users = (await db.execute(select(User))).scalars().all()
5.      polls = (await db.execute(select(Poll))).scalars().all()
6.      
7.      backup_data = {
8.          "metadata": {"timestamp": str(datetime.utcnow())},
9.          "users": [{"email": u.email, "role": u.role} for u in users],
10.         "polls": [{"title": p.title, "room": p.room_id} for p in polls]
11.     }
12.     
13.     file_stream = io.BytesIO(json.dumps(backup_data, indent=4).encode("utf-8"))
14.     
15.     # Логування дії
16.     await log_action(db, admin.email, "BACKUP_CREATED", "Full dump downloaded")
17.     
18.     return StreamingResponse(
19.         file_stream, 
20.         media_type="application/json", 
21.         headers={"Content-Disposition": "attachment; filename=backup.json"}
22.     )

















4 ВИСНОВКИ
     У ході виконання лабораторної роботи було реалізовано складну бізнес-логіку серверної частини, що включає математичну обробку статистичних даних. Розроблено та впроваджено модуль адміністрування з функціями рольового доступу (RBAC), аудиту подій та резервного копіювання даних. Реалізовано механізми локалізації інтерфейсу. Проведено тестування розроблених функцій, що підтвердило їх коректність та відповідність вимогам.















5 ВИКОРИСТАНІ ДЖЕРЕЛА
1. Vision and Scope: Uk-v2. Харків: Харківський національний університет радіоелектроніки, 2024. URL: https://dl.nure.ua/pluginfile.php/1138788/mod_resource/content/1/Vision_and_Scope_uk-v2.pdf
2. IEEE Std 830-1998 — IEEE Recommended Practice for Software Requirements Specifications.
3. FastAPI Documentation: https://fastapi.tiangolo.com
4. PostgreSQL Documentation: https://www.postgresql.org/docs/
5. SQLAlchemy Documentation: https://docs.sqlalchemy.org



















ДОДАТОК А 
Посилання на відео: https://youtu.be/efvVa44aikE
00:00 – Вступ
00:15 – Авторизація
01:00 – Дії адміністратора
01:39 – Створення бекапу
02:11 – Демонстрація аналітики
04:32 – Демонстрація коду аналітики











2


